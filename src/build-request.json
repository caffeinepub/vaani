{
  "kind": "build_request",
  "title": "Fix blank/white screen crash by ensuring Header uses TanStack Router hooks only when RouterProvider is mounted",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-53",
      "text": "Fix the blank/white screen crash caused by TanStack Router context being unavailable when `frontend/src/components/Header.tsx` renders: ensure `Header` does not call `useRouterState()` and `useNavigate()` unless Router context exists, OR ensure `Header` only renders strictly inside the `RouterProvider` tree (source-level fix only; do not edit any compiled bundle files).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-13"
        ],
        "quotes": [
          "Update the Header source file so that it does NOT call useRouterState / useNavigate unless Router context exists,\nOR\nMove Header to render strictly inside the RouterProvider tree."
        ]
      },
      "acceptanceCriteria": [
        "The app no longer crashes to a blank/white screen on load/refresh due to the router store error shown in the compiled bundle (`return useStore(router.__store, (state) => {})`).",
        "`frontend/src/components/Header.tsx` no longer unconditionally calls TanStack Router hooks (`useRouterState`, `useNavigate`) when Router context is not yet available.",
        "No compiled/build output files are edited as part of the fix (only source files)."
      ]
    },
    {
      "id": "REQ-54",
      "text": "Update the application mounting so the routed app is rendered through TanStack Router using the existing `routeTree` (with `/` and `/studio`), ensuring the RouterProvider is mounted before any component that calls TanStack Router hooks (including `Header`) can render.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-13"
        ],
        "quotes": [
          "The root cause is that Header is calling useRouterState() before the RouterProvider is mounted."
        ]
      },
      "acceptanceCriteria": [
        "`frontend/src/main.tsx` mounts the application under a TanStack `RouterProvider` that uses the existing router created from `frontend/src/router.ts` and `frontend/src/routeTree.tsx`.",
        "Route paths and definitions remain unchanged (still `/` -> `App`, `/studio` -> `Studio`).",
        "After deployment, navigating between `/` and `/studio` works without router-context crashes."
      ]
    },
    {
      "id": "REQ-55",
      "text": "Redeploy after applying the router-provider order fix and verify the initial load no longer results in a blank/white screen.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-13"
        ],
        "quotes": [
          "Proceed with this fix and redeploy."
        ]
      },
      "acceptanceCriteria": [
        "A new deployment is produced with the fix.",
        "On first paint / initial load, the UI renders (no blank/white screen) and the console no longer shows the router `__store`/`_store` null-access crash."
      ]
    }
  ],
  "constraints": [
    "Do not edit any compiled/bundled files (the error line shown is from the compiled router bundle).",
    "Do not ask the user for more screenshots.",
    "Do not change authentication behavior, admin/role logic, backend code, or route definitions/paths (`/` and `/studio`).",
    "Keep changes narrowly scoped to resolving the Router context crash (provider order and/or Header hook-usage guard).",
    "Use English for any user-facing text."
  ],
  "nonGoals": [
    "Refactoring unrelated UI/components beyond what is necessary to fix the Router context crash.",
    "Adding new auth flows, role features, or backend endpoints.",
    "Changing the existing navigation structure or introducing new routes."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}